<main id="main" class="main">
    <div class="pagetitle">
        <h1>Nouveau Rendez vous</h1>
    </div>
    <section class="section">
        <div class="row">
            <div class="col-lg-12">
                <div class="card">
                    <div class="card-body">
                        <div class="row">
                            <div class="col-md-6" style="margin-top: 10px;">
                                <label for="yourName" class="form-label">Date de Rendez vous</label>
                                
                                <div class="input-group" *ngIf="servicesReserverFilter.length === 0">
                                    <input type="date" name="date" [(ngModel)]="date" (input)="effacerErreur('date')"
                                        class="form-control" id="date">
                                    <div class="input-group-append" *ngIf="erreurs && erreurs['date']">
                                        <span class="input-group-text">
                                            <i class="bi bi-exclamation-triangle-fill text-danger"></i>
                                        </span>
                                    </div>
                                </div>

                                <div class="input-group" *ngIf="servicesReserverFilter.length > 0">
                                    <input type="date" name="date" [(ngModel)]="date" (input)="effacerErreur('date')"
                                        class="form-control" id="date" disabled>
                                    <div class="input-group-append" *ngIf="erreurs && erreurs['date']">
                                        <span class="input-group-text">
                                            <i class="bi bi-exclamation-triangle-fill text-danger"></i>
                                        </span>
                                    </div>
                                </div>

                                <div *ngIf="erreurs && erreurs['date']" class="text-danger">{{erreurs['date']}}</div>
                            </div>
                            <div class="col-md-3" style="margin-top: 10px;">
                                <label for="yourName" class="form-label">Montant total</label>
                                <h6 class="text-success"><i class="bi bi-cash-stack"></i> {{prixTotal}}
                                    Ar</h6>
                            </div>
                            <div class="col-md-3" style="margin-top: 10px;">
                                <button type="button" class="btn btn-outline-primary" (click)="nouveau()">nouveau rendez-vous</button>                                
                            </div>
                        </div>
                    </div>
                </div>
            </div>
            <div class="col-lg-6">
                <div class="card">
                    <div class="card-body" (dragover)="allowDropRendez($event)" (drop)="dropS($event)">
                        <h5 class="card-title">Liste des Services <span>| Déplacer dans service réserver pour réserver</span></h5>
                        <!---S'il y a loading -->
                        <div *ngIf="loadingService">
                            <div style="text-align: center;">
                                <app-loading></app-loading>
                            </div>
                        </div>
                        <div class="row g-3 accordion" *ngIf="servicesFilter.length === 0" style="height: 300px;">

                        </div>
                        <div class="row g-3" *ngIf="servicesFilter.length > 0" style="margin-top: 2px;">
                            <div class="col-6" *ngFor="let service of servicesFilter" draggable="true"
                                (dragstart)="dragService($event,service)">
                                <div class="card">
                                    <div class="card-body">
                                        <h5 class="card-title">{{service.nom}}</h5>
                                        <h6 class="text-success"><i class="bi bi-cash-stack"></i> {{service.prixFormat}}
                                            Ar</h6>
                                        <p class="small text-muted"><strong>duree : </strong>{{service.dureeFormat}}</p>
                                        <p class="small text-muted"><strong>commission : </strong><span
                                                class="text-success small pt-1 fw-bold">{{service.commission}}%</span>
                                        </p>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
            <div class="col-lg-6">
                <div class="card" (dragover)="allowDropRendez($event)" (drop)="dropReseve($event)">
                    <div class="card-body">
                        <h5 class="card-title">Les services réserver <span> | Déplacer dans le liste service pour annuler la réservation</span></h5>
                        <div *ngIf="loadingReserver">
                            <div style="text-align: center;">
                                <app-loading></app-loading>
                            </div>
                        </div>
                        <div class="row g-3" *ngIf="servicesReserverFilter.length === 0" style="height: 300px;">

                        </div>
                        <div class="row g-3" *ngIf="servicesReserverFilter.length > 0" style="margin-top: 2px;">
                            <div class="col-6" *ngFor="let service of servicesReserverFilter" draggable="true"
                                (dragstart)="dragReserver($event,service)">
                                <div class="card">
                                    <div class="card-body">
                                        <h5 class="card-title">{{service.service.nom}}</h5>
                                        <h6 class="text-success"><i class="bi bi-cash-stack"></i>
                                            {{service.prixFormat}}
                                            Ar</h6>
                                        <p class="small text-muted"><strong>duree :
                                            </strong>{{service.dureeFormat}}</p>
                                        <p class="small text-muted"><strong>commission : </strong><span
                                                class="text-success small pt-1 fw-bold">{{service.commission}}%</span>
                                        </p>
                                        <p class="small text-muted"><strong>Heure : </strong><span
                                                class="text-success small pt-1 fw-bold">{{service.heure}}</span>
                                        </p>
                                        <p class="small text-muted"><strong>Email Employe : </strong><span
                                                class="text-success small pt-1 fw-bold">{{service.employe.email}}</span>
                                        </p>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </section>
</main>

<div id="modalShow" *ngIf="showModalFlag">
    <div class="modal show" tabindex="-1" role="dialog" aria-modal="true" style="display: block;">
        <div class="modal-dialog modal-xl">
            <div class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title">Choisissez parmis les employes</h5>
                    <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"
                        (click)="hideModal()"></button>
                </div>
                <div class="modal-body">
                    <div *ngIf="loadingEmp">
                        <div style="text-align: center;">
                            <app-loading></app-loading>
                        </div>
                    </div>
                    <div class="row" style="padding: 10px;">
                        <div class="col-md-6" style="margin-top: 0px;">
                            <label for="yourName" class="form-label">Montant à payer</label>
                            <h6 class="text-success"><i class="bi bi-cash-stack"></i> {{service.prixFormat}}
                                Ar</h6>
                        </div>
                        <div class="col-md-3" style="margin-top: 0px;">
                            <label for="yourName" class="form-label">Entre votre Montant</label>
                            <div class="input-group" >
                                <input type="number" name="paye" [(ngModel)]="paye" (input)="effacerErreur('paye')"
                                    class="form-control form-control-sm" id="paye">
                                <div class="input-group-append" *ngIf="erreurs && erreurs['paye']">
                                    <span class="input-group-text">
                                        <i class="bi bi-exclamation-triangle-fill text-danger"></i>
                                    </span>
                                </div>
                            </div>
                            <div *ngIf="erreurs && erreurs['paye']" class="text-danger">{{erreurs['paye']}}</div>
                        </div>
                    </div>
                    
                    <table class="table table-bordered">
                        <thead>
                            <tr>
                                <th scope="col">Heure</th>
                                <th scope="col">Nom Employe</th>
                                <th scope="col">Prenom Employe</th>
                                <th scope="col">Email Employe</th>
                                <th scope="col"></th>
                            </tr>
                        </thead>
                        <tbody *ngIf="employeDisp">
                            <tr *ngFor="let employe of employeDisp">
                                <th scope="row">{{employe.heureDisp}}</th>
                                <td>{{employe.employe.personne.nom}}</td>
                                <td>{{employe.employe.personne.prenom}}</td>
                                <td>{{employe.employe.email}}</td>
                                <td><button type="button" class="btn btn-success btn-sm"
                                        (click)="validationEmploye(employe)">valider</button></td>
                            </tr>
                        </tbody>
                    </table>
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-secondary" data-bs-dismiss="modal"
                        (click)="hideModal()">annuler</button>
                </div>
            </div>
        </div>
    </div>
    <style>
        body {
            overflow: hidden;
            padding-right: 17px;
            background-color: darkgray;
        }
    </style>
</div>